{% load bootstrap4 %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{title}}</title>
    {% bootstrap_css %}
    {% bootstrap_javascript jquery='full' %}
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <a class="navbar-brand" href="{% url 'shop:ShopHome' %}">E-Commerce</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse"
          data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav mr-auto">
      <li class="nav-item active">
        <a class="nav-link" href="{% url 'shop:ShopHome' %}">Home <span class="sr-only">(current)</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="{% url 'shop:AboutUs' %}">About Us</a>
      </li>
        <li class="nav-item">
        <a class="nav-link" href="{% url 'shop:TrackingStatus' %}">Tracker</a>
      </li>
        <li class="nav-item">
        <a class="nav-link" href="{% url 'shop:ContactUs' %}">Contact Us</a>
      </li>
    </ul>
    <form class="form-inline my-2 my-lg-0">
      <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
      <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
    </form>
      <button type="button" class="btn btn-secondary mx-2" data-container="body" id="popcart"
              data-toggle="popover" data-placement="bottom" data-html="true">
                Cart(<span id="cart">0</span>)
    </button>
  </div>
</nav>
{% block css %}{% endblock css %}
{% block content %}{% endblock content %}
{% block js %}
    <script>
   // find out cart items from local storage
    if(localStorage.getItem('cart') == null){
    var cart = {};
    }
    else
    {
    cart = JSON.parse(localStorage.getItem('cart'));
    document.getElementById('cart').innerHTML = Object.keys(cart).length;
    updateCart(cart);
    }
    // If the add to cart button is clicked add/increment the item
    $('.cart').click(function(){
    var idstr = this.id.toString();
    console.log(idstr);
    if (cart[idstr] !==undefined){
    cart[idstr] = cart[idstr] + 1;
    }
    else
    {
    cart[idstr] = 1;
    }
    updateCart(cart);
    });
    //add pop over to cart
    $('#popcart').popover({trigger: 'focus'})
    document.getElementById("popcart").setAttribute('data-content', '<h5>Items in your Cart</h5>');
    function updateCart(cart) {
        for (var item in cart){
            document.getElementById('div'+item).innerHTML= "<button id='minus"+item+"'" +
                "class='btn btn-primary minus'>-</button><span id='val"+item+"''>"+cart[item]+
                "</span> <button id='plus"+item+"' class='btn btn-primary plus'>+</bbutton>";
        }
        localStorage.setItem('cart', JSON.stringify(cart));
    document.getElementById('cart').innerHTML = Object.keys(cart).length;
    }
    // If plus or minus button is clicked, change the cart as well as display value
    $('.divpr').on("click", "button.minus", function () {
        minusBtnId = this.id.slice(7, )
        cart['pr'+minusBtnId]=cart['pr'+minusBtnId]-1;
        cart['pr'+minusBtnId]=Math.max(0, cart['pr'+minusBtnId])
        document.getElementById('valpr'+minusBtnId).innerHTML=cart['pr'+minusBtnId]
        updateCart(cart)
    });
    $('.divpr').on("click", "button.plus", function () {
        plusBtnId = this.id.slice(6, )
        cart['pr'+plusBtnId]=cart['pr'+plusBtnId]+1;
        document.getElementById('valpr'+plusBtnId).innerHTML=cart['pr'+plusBtnId]
        updateCart(cart)
    });
</script>
{% endblock js %}
</body>
</html>